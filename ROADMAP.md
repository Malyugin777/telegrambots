# NEXUS ROADMAP

## Текущий статус: Фаза 6 ЗАВЕРШЕНА ✅

**Версия:** 1.2.1
**Последнее обновление:** 2026-01-18

### Выполнено:
- [x] Исправлен график активности (включает сегодня)
- [x] Исправлен подсчёт юзеров бота
- [x] Исправлен парсинг details в логах
- [x] Статистика по платформам (Pie chart)
- [x] Drag & Drop загрузка изображений
- [x] Профиль пользователя с активностью
- [x] Версия в футере
- [x] Исправлен aspect ratio видео (SAR fix)
- [x] **JSON парсинг ffprobe (критический баг)** — v1.2.1
- [x] **Billing Tracker (Фаза 3)** — управление подписками
- [x] **Bot Messages Editor (Фаза 5)** — редактирование текстов бота
- [x] **Performance Monitor (Фаза 6)** — метрики производительности
- [x] **YouTube полные видео** — до 2GB с отправкой как документ
- [x] **Pinterest pin.it** — поддержка коротких ссылок

---

## ФАЗА 3: Исправление видео + Счётчик ошибок

### 3.1 Видео Aspect Ratio ✅ ЗАВЕРШЕНО
- [x] Проверка SAR через ffprobe (JSON формат)
- [x] Если SAR=1:1 и H.264 — пропускаем
- [x] Если кодек не H.264 — перекодируем в H.264
- [x] Если SAR≠1:1 — scale с явным расчётом пикселей
- [x] Исправлено в rapidapi_downloader.py и downloader.py
- [x] Детальное логирование [FIX_VIDEO] / [FIX_TIKTOK]

### 3.2 Страница ошибок /errors ✅ ЗАВЕРШЕНО
- [x] Таблица ошибок с фильтрами
- [x] Статистика: всего, сегодня, по платформам
- [x] Используется ActionLog с action='error'

---

## ФАЗА 4: Billing Tracker (Трекер оплат) ✅ ЗАВЕРШЕНО

### Таблица `subscriptions`:
```sql
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),           -- "Aeza VPS", "RapidAPI", "Hostkey"
    provider_url VARCHAR(255),    -- Ссылка на ЛК
    amount DECIMAL(10,2),
    currency VARCHAR(3),          -- RUB, USD
    billing_cycle VARCHAR(20),    -- monthly, yearly
    next_payment_date DATE,
    auto_renew BOOLEAN,
    notes TEXT,
    created_at TIMESTAMP
);
```

### Функционал:
- [x] CRUD подписок через админку
- [x] Страница /subscriptions в меню
- [x] Dashboard виджет "Ближайшие платежи"
- [x] История платежей

---

## ФАЗА 5: Bot Customization (Настройка бота) ✅ ЗАВЕРШЕНО

### 5.1 Редактор сообщений
```
Таблица bot_messages:
- id
- bot_id
- message_key (start, help, download_success, error, etc.)
- text_ru
- text_en
- is_active
- updated_at
```

### Функционал:
- [x] Страница /bot-messages в админке
- [x] Редактор текстов с сохранением в БД
- [x] Авто-обновление кэша бота (60s TTL)
- [x] Поддержка русского и английского языков
- [x] Эмодзи в сообщениях

---

## ФАЗА 6: Performance Monitor ✅ ЗАВЕРШЕНО

### 6.1 Метрики скачивания
```python
# В ActionLog добавлены поля:
- download_time_ms: int      # Время скачивания
- file_size_bytes: bigint    # Размер файла
- download_speed_kbps: int   # Скорость KB/s
```

### 6.2 Dashboard виджеты:
- [x] Средняя скорость скачивания
- [x] Средний размер файла
- [x] Среднее время скачивания
- [x] API endpoint GET /api/v1/stats/performance
- [x] Метрики по платформам (Instagram, TikTok, YouTube, Pinterest)

---

## ФАЗА 7: Деплой на Hostkey

### Текущая архитектура:
```
HOSTKEY (66.151.33.167)          AEZA (185.96.80.254)
├── PostgreSQL :5432              ├── API (FastAPI) :8000
├── Redis :6379                   ├── Frontend (shadow-api.ru)
└── bot_manager                   └── Nginx + SSL
    └── @SaveNinja_bot
```

### Задачи:
- [ ] Автоматический деплой через GitHub Actions
- [ ] Мониторинг контейнеров
- [ ] Логи в централизованное хранилище

---

## ФАЗА 8: VPN Bot (Новый проект)

### Концепция:
- Telegram бот для продажи VPN
- Интеграция с Outline/WireGuard
- Оплата через Telegram Stars / криптой

### Задачи:
- [ ] Архитектура
- [ ] Выбор VPN протокола
- [ ] Интеграция оплаты
- [ ] Админка для управления ключами

---

## ПРИОРИТЕТЫ

| Приоритет | Задача | Сложность | Статус |
|-----------|--------|-----------|--------|
| ~~1~~ | ~~Фаза 3: Видео SAR + Ошибки~~ | ~~Средняя~~ | ✅ Готово |
| ~~2~~ | ~~Фаза 4: Billing Tracker~~ | ~~Средняя~~ | ✅ Готово |
| ~~3~~ | ~~Фаза 5: Bot Messages Editor~~ | ~~Средняя~~ | ✅ Готово |
| ~~4~~ | ~~Фаза 6: Performance Monitor~~ | ~~Средняя~~ | ✅ Готово |
| 1 | YouTube полные видео | Низкая | ✅ Готово |
| 2 | Фаза 7: GitHub Actions CI/CD | Средняя | Частично |
| 3 | VPN Bot | Высокая | Отдельный проект |

---

## ПРАВИЛА РАБОТЫ С CLAUDE CODE

### Скорость:
```
ЛОКАЛЬНО: Редактирование, npm build, тесты
СЕРВЕР: Только деплой (scp, git pull, docker restart)
```

### Эффективные промпты:
```
✅ "Работай ЛОКАЛЬНО в C:\Projects\TelegramBots"
✅ "Покажи план, потом делай"
✅ "НЕ делай npm install на сервере"
✅ Маленькие задачи вместо "сделай всё"

❌ Длинные сессии (контекст теряется)
❌ Сборка на сервере с 1 ядром
```

### Субагенты:
Это нормально — Claude запускает параллельные задачи для чтения файлов.
Ускоряет работу при исследовании кодовой базы.

### Токены:
Показываются в конце задачи. Если прервал — не покажет.
