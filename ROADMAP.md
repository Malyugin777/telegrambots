# NEXUS ROADMAP

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –§–∞–∑–∞ 7 –í –†–ê–ë–û–¢–ï üî•

**–í–µ—Ä—Å–∏—è:** 1.3.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-20

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞–µ—Ç —Å–µ–≥–æ–¥–Ω—è)
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–¥—Å—á—ë—Ç —é–∑–µ—Ä–æ–≤ –±–æ—Ç–∞
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ details –≤ –ª–æ–≥–∞—Ö
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º (Pie chart)
- [x] Drag & Drop –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [x] –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
- [x] –í–µ—Ä—Å–∏—è –≤ —Ñ—É—Ç–µ—Ä–µ
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω aspect ratio –≤–∏–¥–µ–æ (SAR fix)
- [x] **JSON –ø–∞—Ä—Å–∏–Ω–≥ ffprobe (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥)** ‚Äî v1.2.1
- [x] **Billing Tracker (–§–∞–∑–∞ 3)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- [x] **Bot Messages Editor (–§–∞–∑–∞ 5)** ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –±–æ—Ç–∞
- [x] **Performance Monitor (–§–∞–∑–∞ 6)** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [x] **YouTube –ø–æ–ª–Ω—ã–µ –≤–∏–¥–µ–æ** ‚Äî sendVideo –¥–æ 2GB (Local Bot API)
- [x] **Pinterest pin.it** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫
- [x] **YouTube 3-step fallback** ‚Äî yt-dlp ‚Üí pytubefix ‚Üí RapidAPI
- [x] **A+ remux** ‚Äî stream copy —Å SAR metadata fix

### –í —Ä–∞–±–æ—Ç–µ (–§–∞–∑–∞ 7):
- [ ] Research –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö API (SaveNow, Cobalt)
- [ ] Ops Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- [ ] Error classification (HARD-KILL vs STALL)
- [ ] Cooldown —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è failed –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- [ ] Budget guardrails –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö API
- [ ] Routing UI –≤ –∞–¥–º–∏–Ω–∫–µ

---

## –§–ê–ó–ê 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ + –°—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

### 3.1 –í–∏–¥–µ–æ Aspect Ratio ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ SAR —á–µ—Ä–µ–∑ ffprobe (JSON —Ñ–æ—Ä–º–∞—Ç)
- [x] –ï—Å–ª–∏ SAR=1:1 –∏ H.264 ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
- [x] –ï—Å–ª–∏ –∫–æ–¥–µ–∫ –Ω–µ H.264 ‚Äî –ø–µ—Ä–µ–∫–æ–¥–∏—Ä—É–µ–º –≤ H.264
- [x] –ï—Å–ª–∏ SAR‚â†1:1 ‚Äî scale —Å —è–≤–Ω—ã–º —Ä–∞—Å—á—ë—Ç–æ–º –ø–∏–∫—Å–µ–ª–µ–π
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ rapidapi_downloader.py –∏ downloader.py
- [x] –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ [FIX_VIDEO] / [FIX_TIKTOK]

### 3.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–æ–∫ /errors ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –¢–∞–±–ª–∏—Ü–∞ –æ—à–∏–±–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –≤—Å–µ–≥–æ, —Å–µ–≥–æ–¥–Ω—è, –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
- [x] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ActionLog —Å action='error'

---

## –§–ê–ó–ê 4: Billing Tracker (–¢—Ä–µ–∫–µ—Ä –æ–ø–ª–∞—Ç) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

### –¢–∞–±–ª–∏—Ü–∞ `subscriptions`:
```sql
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),           -- "Aeza VPS", "RapidAPI", "Hostkey"
    provider_url VARCHAR(255),    -- –°—Å—ã–ª–∫–∞ –Ω–∞ –õ–ö
    amount DECIMAL(10,2),
    currency VARCHAR(3),          -- RUB, USD
    billing_cycle VARCHAR(20),    -- monthly, yearly
    next_payment_date DATE,
    auto_renew BOOLEAN,
    notes TEXT,
    created_at TIMESTAMP
);
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- [x] CRUD –ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ /subscriptions –≤ –º–µ–Ω—é
- [x] Dashboard –≤–∏–¥–∂–µ—Ç "–ë–ª–∏–∂–∞–π—à–∏–µ –ø–ª–∞—Ç–µ–∂–∏"
- [x] –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

---

## –§–ê–ó–ê 5: Bot Customization (–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

### 5.1 –†–µ–¥–∞–∫—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
```
–¢–∞–±–ª–∏—Ü–∞ bot_messages:
- id
- bot_id
- message_key (start, help, download_success, error, etc.)
- text_ru
- text_en
- is_active
- updated_at
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ /bot-messages –≤ –∞–¥–º–∏–Ω–∫–µ
- [x] –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
- [x] –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –±–æ—Ç–∞ (60s TTL)
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤
- [x] –≠–º–æ–¥–∑–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

---

## –§–ê–ó–ê 6: Performance Monitor ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

### 6.1 –ú–µ—Ç—Ä–∏–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
```python
# –í ActionLog –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- download_time_ms: int      # –í—Ä–µ–º—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- file_size_bytes: bigint    # –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- download_speed_kbps: int   # –°–∫–æ—Ä–æ—Å—Ç—å KB/s
```

### 6.2 Dashboard –≤–∏–¥–∂–µ—Ç—ã:
- [x] –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- [x] –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- [x] –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- [x] API endpoint GET /api/v1/stats/performance
- [x] –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º (Instagram, TikTok, YouTube, Pinterest)

---

## –§–ê–ó–ê 7: YouTube Provider Routing System üî• –¢–ï–ö–£–©–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

**–ü—Ä–æ–±–ª–µ–º–∞:** YouTube –±–∞–Ω–∏—Ç/—Ç—Ä–æ—Ç–ª–∏—Ç IP —Å–µ—Ä–≤–µ—Ä–∞. yt-dlp, pytubefix –∏ RapidAPI (–∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç googlevideo.com URL) –≤—Å–µ –ª–æ–º–∞—é—Ç—Å—è –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –∫–∞—á–∞—é—Ç 8-—á–∞—Å–æ–≤—ã–µ –≤–∏–¥–µ–æ –∑–∞ —Å–µ–∫—É–Ω–¥—ã.

**SLA:** 2-5 –º–∏–Ω—É—Ç –º–∞–∫—Å –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É. 8+ –º–∏–Ω—É—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ.

**–ö–ª—é—á–µ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:**
```python
MAX_USER_WAIT_SEC = 180  # 3 –º–∏–Ω—É—Ç—ã ‚Äî –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ª–∏–±–æ background queue, –ª–∏–±–æ –æ—Ç–∫–∞–∑
```

---

### 7.0 Telemetry Baseline (Phase 0) ‚úÖ –ß–ê–°–¢–ò–ß–ù–û

**–¶–µ–ª—å:** –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π, "—Å–æ–µ–¥–∏–Ω–∏—Ç—å –ö–ª–æ–¥–∞ —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é".

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- [x] `download_host` logging –≤ RapidAPI (googlevideo.com = –ø–ª–æ—Ö–æ)
- [x] `download_time_ms`, `file_size_bytes`, `download_speed_kbps` –≤ ActionLog

**–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- [ ] `redirect_chain` ‚Äî –µ—Å–ª–∏ API —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ googlevideo
- [ ] `ttfb_ms` (time to first byte) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç latency –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- [ ] `error_type` –≤ ActionLog (HARD_KILL / STALL / PROVIDER_BUG)
- [ ] `duration_bucket` (shorts/medium/long) –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

### 7.1 Research APIs (Phase 1) ‚úÖ –ò–°–°–õ–ï–î–û–í–ê–ù–û

**–ó–∞–¥–∞—á–∞:** –ù–∞–π—Ç–∏ API –∫–æ—Ç–æ—Ä—ã–µ –†–ï–ê–õ–¨–ù–û –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ —Å–≤–æ–π CDN, –∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç googlevideo.com URLs.

| API | CDN | –¶–µ–Ω–∞ | Downloads/–º–µ—Å | –°—Ç–∞—Ç—É—Å |
|-----|-----|------|---------------|--------|
| **RapidAPI (YouTube Info & Download API)** | ‚úÖ `*.savenow.to` | $5/–º–µ—Å Pro | ~16K-33K | üèÜ **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** |
| **youtube-download-api.org** | ‚úÖ `media.yt-data-proxy.org` | $199/–º–µ—Å | –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤? | üí∞ Backup (–¥–æ—Ä–æ–≥–æ) |
| **video-download-api.com** | ‚úÖ —Ç–æ—Ç –∂–µ backend | ~$0.00030/download | pay-per-use | üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |
| **RapidAPI (Social Download All In One)** | ‚ùå googlevideo.com | ~$0.004/download | ‚Äî | ‚ùå –ë–∞–Ω IP |
| **Cobalt.tools** | ‚ùå –ó–∞–±–∞–Ω–µ–Ω YouTube | ‚Äî | ‚Äî | ‚ùå –ù–µ—Å—Ç–∞–±–∏–ª–µ–Ω |

**–í–∞–∂–Ω–æ –ø—Ä–æ SaveNow.to:** –°–∞–π—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É, –Ω–æ —á–µ—Ä–µ–∑ RapidAPI wrapper –ø–æ–ª—É—á–∞–µ–º –ø—Ä—è–º—ã–µ CDN —Å—Å—ã–ª–∫–∏ –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã. API —É–±–∏—Ä–∞–µ—Ç —Ä–µ–∫–ª–∞–º–Ω—ã–π —Å–ª–æ–π.

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (2026-01-20):**

### üèÜ RapidAPI "YouTube Info & Download API" ‚Äî –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û, –†–ê–ë–û–¢–ê–ï–¢!

**–ö–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- **Host:** `youtube-info-download-api.p.rapidapi.com`
- **Backend:** SaveNow.to (wrapper API, –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã)
- **CDN:** ‚úÖ `*.savenow.to` (rose44, pamela88, etc.) ‚Äî **–ù–ï googlevideo.com!**
- **–ù–∞—à IP –Ω–µ –±–∞–Ω–∏—Ç—Å—è YouTube!**

**–¢–µ—Å—Ç—ã:**

| –í–∏–¥–µ–æ | –î–ª–∏–Ω–∞ | Prep time | –†–∞–∑–º–µ—Ä | Cost | CDN Host |
|-------|-------|-----------|--------|------|----------|
| Rick Astley | 3:33 | ~5 —Å–µ–∫ | 30 MB | $0.0003 | `rose44.savenow.to` |
| C# Tutorial | 4:31:09 | ~50 —Å–µ–∫ | 432 MB | $0.0015 | `pamela88.savenow.to` |
| Harvard CS50 | 24+ —á–∞—Å–∞ | ‚Äî | ‚Äî | ‚Äî | ‚ùå "Video too long" |

**–õ–∏–º–∏—Ç—ã:**
- Pro Plan: **$5/–º–µ—Å** = 100,000 units
- 720p/1080p = ~6 units = **~16,000 downloads/–º–µ—Å**
- Extended duration: x3 (90 min over), x5 (180 min over), x33 (24h)
- Overage: $0.000047/unit
- Max video: **~4-5 —á–∞—Å–æ–≤** (24h –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

**–°–∫–æ—Ä–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:** ~1.4 MB/s (—Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã)

**API Flow:**
```
1. POST /ajax/download.php ‚Üí –ø–æ–ª—É—á–∞–µ–º job ID + progress_url
2. Poll progress_url –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
3. –ö–æ–≥–¥–∞ success=1 ‚Üí download_url –≥–æ—Ç–æ–≤
4. download_url = –∏—Ö CDN (*.savenow.to), –Ω–µ googlevideo!
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl "https://youtube-info-download-api.p.rapidapi.com/ajax/download.php?format=720&url=VIDEO_URL&allow_extended_duration=1" \
  -H "x-rapidapi-host: youtube-info-download-api.p.rapidapi.com" \
  -H "x-rapidapi-key: YOUR_KEY"
```

### ‚úÖ youtube-download-api.org ‚Äî CDN –ü–û–î–¢–í–ï–†–ñ–î–Å–ù, –ù–û –î–û–†–û–ì–û
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –∏—Ö CDN: `https://media.yt-data-proxy.org/...`
- –ù–ï googlevideo.com ‚Üí –Ω–∞—à IP –Ω–µ –±–∞–Ω–∏—Ç—Å—è
- <2 —Å–µ–∫ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
- $199/–º–µ—Å flat rate ‚Äî **backup –µ—Å–ª–∏ $5 API –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å**

### ‚úÖ video-download-api.com ‚Äî –¢–û–¢ –ñ–ï BACKEND
- –¢–æ—Ç –∂–µ –∞–≤—Ç–æ—Ä —á—Ç–æ –∏ RapidAPI wrapper (sp_golubev@protonmail.com)
- Pay-per-use ~$0.00030/download
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –µ—Å–ª–∏ RapidAPI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. [x] ~~–¢–µ—Å—Ç CDN~~ ‚Üí **CDN –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω!**
2. [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–∞ ‚Üí `savenow_downloader.py` —Å–æ–∑–¥–∞–Ω!
3. [x] Quota monitoring ‚Üí headers `x-ratelimit-*` –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
4. [ ] A/B —Ç–µ—Å—Ç: pytubefix vs savenow –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
5. [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ costs –≤ –∞–¥–º–∏–Ω–∫–µ

---

### 7.2 Routing Engine Backend (Phase 2)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:**

```python
# –¢–∞–±–ª–∏—Ü–∞ download_providers
CREATE TABLE download_providers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),           -- "yt-dlp", "pytubefix", "rapidapi", "savenow", "cobalt"
    provider_type VARCHAR(20),  -- "local", "api", "egress_pool"
    is_active BOOLEAN,
    priority INT,               -- 1 = highest

    -- –î–ª—è API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
    api_key VARCHAR(255),
    api_host VARCHAR(255),
    rate_limit_per_min INT,

    -- Health tracking
    health_status VARCHAR(20),  -- "healthy", "degraded", "down"
    last_success_at TIMESTAMP,
    last_error_at TIMESTAMP,
    error_count_1h INT,
    success_rate_24h DECIMAL,
    avg_speed_kbps INT,

    -- Cooldown
    cooldown_until TIMESTAMP,   -- NULL = active, datetime = disabled until

    -- Budget (–¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö API)
    daily_budget_usd DECIMAL,
    daily_spent_usd DECIMAL,
    budget_reset_at TIMESTAMP,

    created_at TIMESTAMP
);

# –¢–∞–±–ª–∏—Ü–∞ routing_rules
CREATE TABLE routing_rules (
    id SERIAL PRIMARY KEY,
    platform VARCHAR(20),       -- "youtube", "youtube_shorts", "tiktok", etc
    duration_min INT,           -- NULL = any, 0 = shorts, 300 = >5min
    duration_max INT,           -- NULL = any
    file_size_max_mb INT,

    provider_chain JSONB,       -- ["yt-dlp", "pytubefix", "rapidapi", "savenow"]

    is_active BOOLEAN,
    priority INT,
    created_at TIMESTAMP
);
```

**Error Classification:**
```python
# HARD-KILL errors (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π fallback + cooldown 15-60 –º–∏–Ω)
HARD_KILL_ERRORS = [
    "SSL: UNEXPECTED_EOF",      # YouTube ban
    "HTTP 403 Forbidden",       # IP blocked
    "HTTP 429 Too Many",        # Rate limited
    "Sign in to confirm",       # Age/auth required
]

# STALL errors (retry once, then fallback)
STALL_ERRORS = [
    "Download stalled",         # No progress >30 sec
    "Connection timeout",       # Network issue
    "Incomplete read",          # Partial download
]
```

**Cooldown Logic (per provider:platform:bucket):**
```python
# Cooldown key = {provider}:{platform}:{bucket}
# –ü—Ä–∏–º–µ—Ä: "yt-dlp:youtube:long" ‚Äî yt-dlp –¥–æ—Ö–Ω–µ—Ç –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ shorts
# bucket = "shorts" (<5 min) | "medium" (5-30 min) | "long" (>30 min)

async def on_provider_error(provider: str, platform: str, duration_sec: int, error_type: str):
    bucket = get_duration_bucket(duration_sec)  # shorts/medium/long
    cooldown_key = f"{provider}:{platform}:{bucket}"

    if error_type == "HARD_KILL":
        # –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –Ω–∞ 30 –º–∏–Ω (—Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ bucket!)
        await set_cooldown(cooldown_key, minutes=30)
    elif error_type == "STALL":
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º cooldown —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ
        current = await get_error_count_1h(cooldown_key)
        if current >= 3:
            await set_cooldown(cooldown_key, minutes=15)

def get_duration_bucket(duration_sec: int) -> str:
    if duration_sec < 300: return "shorts"      # <5 min
    if duration_sec < 1800: return "medium"     # 5-30 min
    return "long"                                # >30 min
```

**Budget Guardrails (–ø–ª–∞—Ç–Ω—ã–µ API):**
```python
async def check_budget(provider_id: str) -> bool:
    provider = await get_provider(provider_id)
    if provider.daily_spent_usd >= provider.daily_budget_usd:
        logger.warning(f"[ROUTING] {provider.name} budget exceeded, skipping")
        return False
    return True

async def track_api_cost(provider_id: str, cost_usd: float):
    await increment_daily_spent(provider_id, cost_usd)
```

**Egress Pool (multi-IP):**
```python
# –ü—Ä–æ–≤–∞–π–¥–µ—Ä —Ç–∏–ø–∞ "egress_pool" –¥–ª—è multi-IP —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
# –ü—Ä–∏–º–µ—Ä: –Ω–µ—Å–∫–æ–ª—å–∫–æ VPS –∏–ª–∏ –ø—Ä–æ–∫—Å–∏ –¥–ª—è yt-dlp
class EgressPoolProvider:
    def __init__(self, endpoints: list[str]):
        # ["vps1.example.com", "vps2.example.com", ...]
        self.endpoints = endpoints
        self.current_index = 0

    async def download(self, url: str) -> DownloadResult:
        # Round-robin –∏–ª–∏ –≤—ã–±–æ—Ä –ø–æ –∑–¥–æ—Ä–æ–≤—å—é
        endpoint = self.get_healthy_endpoint()
        return await self.download_via_endpoint(endpoint, url)
```

**Concurrency Manager (–ø–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π):**
```python
# Redis-based concurrency limits
# –í–ê–ñ–ù–û: YouTube –±–∞–Ω–∏—Ç –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö!
CONCURRENCY_LIMITS = {
    # YouTube ‚Äî –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π IP –±–∞–Ω, –¥–µ—Ä–∂–∏–º –Ω–∏–∑–∫–æ
    "youtube:yt-dlp": 2,        # Max 2 concurrent yt-dlp YouTube
    "youtube:pytubefix": 2,     # Max 2 concurrent pytubefix
    "youtube:rapidapi": 3,      # RapidAPI —á—É—Ç—å –±–æ–ª—å—à–µ (–∏—Ö IP)

    # –î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ‚Äî –±–æ–ª–µ–µ –ª–æ—è–ª—å–Ω—ã–µ
    "instagram:rapidapi": 5,    # Instagram —á–µ—Ä–µ–∑ RapidAPI
    "tiktok:yt-dlp": 5,         # TikTok –±–æ–ª–µ–µ –ª–æ—è–ª–µ–Ω
    "pinterest:yt-dlp": 5,      # Pinterest —Ç–æ–∂–µ

    # –û–±—â–∏–µ –ª–∏–º–∏—Ç—ã
    "telegram_upload": 10,      # Max 10 concurrent uploads
    "ffmpeg_process": 3,        # Max 3 concurrent ffmpeg
}

async def acquire_slot(category: str, timeout: int = 60) -> bool:
    key = f"concurrency:{category}"
    current = await redis.incr(key)
    if current > CONCURRENCY_LIMITS.get(category, 10):
        await redis.decr(key)
        return False
    await redis.expire(key, timeout)
    return True
```

---

### 7.3 Admin Panel UI (Phase 3)

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–∞—á–∏–Ω–∞–µ–º —Å Ops Dashboard):**

#### 7.3.1 Ops Dashboard (–ü–ï–†–í–´–ô –ü–†–ò–û–†–ò–¢–ï–¢)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üéõÔ∏è Operations Dashboard                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Provider Health ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ yt-dlp      üü¢ Healthy   Speed: 5.2 MB/s   Err: 2%    ‚îÇ  ‚îÇ
‚îÇ ‚îÇ pytubefix   üü° Degraded  Speed: 3.1 MB/s   Err: 15%   ‚îÇ  ‚îÇ
‚îÇ ‚îÇ RapidAPI    üî¥ Down      Cooldown: 28 min  Err: 89%   ‚îÇ  ‚îÇ
‚îÇ ‚îÇ SaveNow     üü¢ Healthy   Speed: 8.4 MB/s   Err: 1%    ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Real-time Metrics ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ Downloads/hour: 847     Success rate: 94%             ‚îÇ  ‚îÇ
‚îÇ ‚îÇ Avg speed: 4.8 MB/s     Avg time: 12.3s               ‚îÇ  ‚îÇ
‚îÇ ‚îÇ YouTube errors: 23      Budget used: $4.20/$10        ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Active Cooldowns ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ RapidAPI: SSL_EOF (28 min left)                       ‚îÇ  ‚îÇ
‚îÇ ‚îÇ yt-dlp:youtube_long: STALL (12 min left)             ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Recent Errors ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ 14:23  YouTube  RapidAPI  SSL_UNEXPECTED_EOF          ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 14:21  YouTube  yt-dlp    Download stalled            ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 14:18  TikTok   yt-dlp    Rate limited                ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 7.3.2 Alerts System
```python
# –ê–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram –∞–¥–º–∏–Ω—É
ALERT_RULES = {
    "provider_down": {
        "condition": "error_rate_1h > 50%",
        "cooldown": "15 min",
        "message": "üî¥ {provider} down: {error_rate}% errors"
    },
    "budget_warning": {
        "condition": "daily_spent > 80% of budget",
        "cooldown": "1 hour",
        "message": "üí∞ {provider} budget warning: ${spent}/${budget}"
    },
    "all_providers_down": {
        "condition": "all providers for platform in cooldown",
        "cooldown": "5 min",
        "message": "üö® CRITICAL: No working providers for {platform}"
    }
}
```

#### 7.3.3 Routing UI (–í–¢–û–†–û–ô –ü–†–ò–û–†–ò–¢–ï–¢)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üîÄ Download Routing Rules                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ Platform: [YouTube ‚ñº]  Duration: [Any ‚ñº]                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Provider Chain (drag to reorder) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ 1. ‚¨õ yt-dlp          [üü¢ Active] [‚öôÔ∏è Config]         ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 2. ‚¨õ pytubefix       [üü¢ Active] [‚öôÔ∏è Config]         ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 3. ‚¨õ SaveNow API     [üü¢ Active] [‚öôÔ∏è Config]         ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 4. ‚¨õ RapidAPI        [üü° Budget] [‚öôÔ∏è Config]         ‚îÇ  ‚îÇ
‚îÇ ‚îÇ                                                        ‚îÇ  ‚îÇ
‚îÇ ‚îÇ [+ Add Provider]                                       ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Rule Settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ Duration min: [    ] sec   Duration max: [    ] sec   ‚îÇ  ‚îÇ
‚îÇ ‚îÇ Max file size: [2000] MB   Priority: [1]              ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [Save Rule] [Test Rule] [Delete]                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 7.3.4 Provider Management
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚öôÔ∏è Provider: SaveNow API                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ Type: [API ‚ñº]  Status: [üü¢ Active ‚ñº]                        ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ API Configuration ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ API Key: [sk-xxxxxxxxxxxxxxxx]                        ‚îÇ  ‚îÇ
‚îÇ ‚îÇ API Host: [api.savenow.io]                            ‚îÇ  ‚îÇ
‚îÇ ‚îÇ Rate Limit: [60] req/min                              ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Budget ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ Daily Budget: [$10.00]    Spent Today: $4.20          ‚îÇ  ‚îÇ
‚îÇ ‚îÇ [x] Auto-disable when budget exceeded                 ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ Health (24h) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ Success Rate: 98.5%       Avg Speed: 8.4 MB/s         ‚îÇ  ‚îÇ
‚îÇ ‚îÇ Total Downloads: 1,247    Errors: 19                  ‚îÇ  ‚îÇ
‚îÇ ‚îÇ [üìä View detailed stats]                              ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [Save] [Test Connection] [View Logs]                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 7.4 Future Improvements (Post-MVP)

**–û—Ç–ª–æ–∂–µ–Ω–æ –Ω–∞ –ø–æ—Ç–æ–º:**
- [ ] **Async delivery mode** ‚Äî –¥–ª—è –≤–∏–¥–µ–æ >30 –º–∏–Ω: "–≥–æ—Ç–æ–≤–ª—é, –ø—Ä–∏—à–ª—é –ø–æ–∑–∂–µ" + background worker
- [ ] **Soft fail budget** ‚Äî –±—é–¥–∂–µ—Ç –∫–æ–Ω—á–∏–ª—Å—è ‚Üí "YouTube –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ" –≤–º–µ—Å—Ç–æ hard block
- [ ] **Cancellation-safe downloads** ‚Äî async cancel –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –º—É—Å–æ—Ä (tmp files, zombie processes)
- [ ] **Centralized download orchestrator** ‚Äî –æ–¥–∏–Ω –º–æ–¥—É–ª—å –¥–ª—è fallback –ª–æ–≥–∏–∫–∏ (—Å–µ–π—á–∞—Å —Ä–∞–∑–º–∞–∑–∞–Ω–æ –ø–æ —Ñ–∞–π–ª–∞–º)

---

### 7.5 Testing & Optimization (Phase 4)

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- [ ] Short video (<5 min) - –¥–æ–ª–∂–µ–Ω –∫–∞—á–∞—Ç—å—Å—è –∑–∞ <10 —Å–µ–∫
- [ ] Medium video (5-30 min) - –¥–æ–ª–∂–µ–Ω –∫–∞—á–∞—Ç—å—Å—è –∑–∞ <2 –º–∏–Ω
- [ ] Long video (30-60 min) - –¥–æ–ª–∂–µ–Ω –∫–∞—á–∞—Ç—å—Å—è –∑–∞ <5 –º–∏–Ω –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
- [ ] Very long video (>60 min) - fallback chain –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:**
- Success rate >95% –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ
- Success rate >85% –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è fallback <5 —Å–µ–∫
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–∏–Ω –ø–æ—Å–ª–µ –ø—Ä–æ–±–ª–µ–º—ã

---

### 7.6 VPS Scaling

**–¢–µ–∫—É—â–∏–π VPS (Hostkey):**
- 2 vCore, 2GB RAM, 3TB traffic
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 10K+ users/day

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:**
- Traffic: 20-30TB/month –º–∏–Ω–∏–º—É–º
- RAM: 4-8GB –¥–ª—è concurrent downloads
- CPU: 4+ cores –¥–ª—è ffmpeg
- –í–æ–∑–º–æ–∂–Ω–æ: –æ—Ç–¥–µ–ª—å–Ω—ã–π VPS –¥–ª—è egress pool

---

## –§–ê–ó–ê 8: –î–µ–ø–ª–æ–π –Ω–∞ Hostkey

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
HOSTKEY (66.151.33.167)          AEZA (185.96.80.254)
‚îú‚îÄ‚îÄ PostgreSQL :5432              ‚îú‚îÄ‚îÄ API (FastAPI) :8000
‚îú‚îÄ‚îÄ Redis :6379                   ‚îú‚îÄ‚îÄ Frontend (shadow-api.ru)
‚îî‚îÄ‚îÄ bot_manager                   ‚îî‚îÄ‚îÄ Nginx + SSL
    ‚îî‚îÄ‚îÄ @SaveNinja_bot
```

### –ó–∞–¥–∞—á–∏:
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- [ ] –õ–æ–≥–∏ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

---

## –§–ê–ó–ê 9: VPN Bot (–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç)

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è:
- Telegram –±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ VPN
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Outline/WireGuard
- –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars / –∫—Ä–∏–ø—Ç–æ–π

### –ó–∞–¥–∞—á–∏:
- [ ] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –í—ã–±–æ—Ä VPN –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã
- [ ] –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏

---

## –ü–†–ò–û–†–ò–¢–ï–¢–´

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ó–∞–¥–∞—á–∞ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|-----------|--------|-----------|--------|
| ~~1~~ | ~~–§–∞–∑–∞ 3: –í–∏–¥–µ–æ SAR + –û—à–∏–±–∫–∏~~ | ~~–°—Ä–µ–¥–Ω—è—è~~ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| ~~2~~ | ~~–§–∞–∑–∞ 4: Billing Tracker~~ | ~~–°—Ä–µ–¥–Ω—è—è~~ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| ~~3~~ | ~~–§–∞–∑–∞ 5: Bot Messages Editor~~ | ~~–°—Ä–µ–¥–Ω—è—è~~ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| ~~4~~ | ~~–§–∞–∑–∞ 6: Performance Monitor~~ | ~~–°—Ä–µ–¥–Ω—è—è~~ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| ~~5~~ | ~~YouTube –ø–æ–ª–Ω—ã–µ –≤–∏–¥–µ–æ~~ | ~~–ù–∏–∑–∫–∞—è~~ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| **1** | **–§–∞–∑–∞ 7: YouTube Provider Routing** | **–í—ã—Å–æ–∫–∞—è** | üî• –í —Ä–∞–±–æ—Ç–µ |
| 2 | –§–∞–∑–∞ 8: GitHub Actions CI/CD | –°—Ä–µ–¥–Ω—è—è | –ß–∞—Å—Ç–∏—á–Ω–æ |
| 3 | –§–∞–∑–∞ 9: VPN Bot | –í—ã—Å–æ–∫–∞—è | –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç |

---

## –ü–†–ê–í–ò–õ–ê –†–ê–ë–û–¢–´ –° CLAUDE CODE

### –°–∫–æ—Ä–æ—Å—Ç—å:
```
–õ–û–ö–ê–õ–¨–ù–û: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, npm build, —Ç–µ—Å—Ç—ã
–°–ï–†–í–ï–†: –¢–æ–ª—å–∫–æ –¥–µ–ø–ª–æ–π (scp, git pull, docker restart)
```

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã:
```
‚úÖ "–†–∞–±–æ—Ç–∞–π –õ–û–ö–ê–õ–¨–ù–û –≤ C:\Projects\TelegramBots"
‚úÖ "–ü–æ–∫–∞–∂–∏ –ø–ª–∞–Ω, –ø–æ—Ç–æ–º –¥–µ–ª–∞–π"
‚úÖ "–ù–ï –¥–µ–ª–∞–π npm install –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
‚úÖ –ú–∞–ª–µ–Ω—å–∫–∏–µ –∑–∞–¥–∞—á–∏ –≤–º–µ—Å—Ç–æ "—Å–¥–µ–ª–∞–π –≤—Å—ë"

‚ùå –î–ª–∏–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (–∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ—Ä—è–µ—Ç—Å—è)
‚ùå –°–±–æ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å 1 —è–¥—Ä–æ–º
```

### –°—É–±–∞–≥–µ–Ω—Ç—ã:
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî Claude –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.
–£—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã.

### –¢–æ–∫–µ–Ω—ã:
–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –∑–∞–¥–∞—á–∏. –ï—Å–ª–∏ –ø—Ä–µ—Ä–≤–∞–ª ‚Äî –Ω–µ –ø–æ–∫–∞–∂–µ—Ç.
